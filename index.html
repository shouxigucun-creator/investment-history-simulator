<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æŠ•è³‡ã®æ­´å²ä½“é¨“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆ1925â€“2025ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1976d2">
<style>
  body { font-family: sans-serif; background:#f5f5f5; padding:16px; }
  h1 { font-size:20px; }
  label { display:block; margin-top:10px; }
  select, input, button { width:100%; padding:8px; margin-top:4px; }
  canvas { width:100%; margin-top:10px; }
  #resultCard { background:#fff; padding:16px; border-radius:8px; margin-top:16px; }
  ul { padding-left:18px; }
  button { margin-top:12px; }
</style>
</head>
<body>

<h1>ğŸ“˜ æŠ•è³‡ã®æ­´å²ä½“é¨“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
<p style="font-size:14px;color:#555">
1925å¹´ã€œ2025å¹´ã®éå»ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ã€æš´è½ã¨å›å¾©ã‚’ä½“é¨“çš„ã«å­¦ã¶æ•™è‚²ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚
</p>

<label>é–‹å§‹å¹´</label>
<input id="startYear" type="number" value="1980">

<label>çµ‚äº†å¹´</label>
<input id="endYear" type="number" value="2025">

<label>è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰</label>
<select id="mode">
  <option value="compare">ç±³å›½æ ª vs æ—¥æœ¬æ ª</option>
  <option value="single">å˜ä¸€éŠ˜æŸ„</option>
</select>

<label id="assetLabel" style="display:none">æŠ•è³‡å¯¾è±¡</label>
<select id="asset" style="display:none">
  <option value="sp500">ç±³å›½æ ªï¼ˆS&P500ï¼‰</option>
  <option value="nikkei">æ—¥æœ¬æ ªï¼ˆæ—¥çµŒå¹³å‡ï¼‰</option>
  <option value="cash">ç¾é‡‘ï¼ˆ0%ï¼‰</option>
</select>

<button onclick="run()">â–¶ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
<button onclick="saveResultImage()">ğŸ“¸ çµæœã‚’ç”»åƒã§ä¿å­˜</button>

<div id="resultCard">
  <h2>çµæœ</h2>
  <div id="output"></div>
  <canvas id="chart"></canvas>
  <div id="crashInfo"></div>
  <div id="learningPoints"></div>
  <p style="font-size:11px;color:#666">
    æœ¬ã‚¢ãƒ—ãƒªã¯å­¦ç¿’ç›®çš„ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€å°†æ¥ã®æŠ•è³‡æˆæœã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
  </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

const INITIAL_ASSET = 1000000;
const returns = {};
for (let y = 1925; y <= 2025; y++) returns[y] = { sp500:0.07, nikkei:0.04 };
Object.assign(returns[1929], { sp500:-0.5, nikkei:-0.4 });
Object.assign(returns[1973], { sp500:-0.3, nikkei:-0.4 });
Object.assign(returns[1987], { sp500:-0.2, nikkei:-0.15 });
Object.assign(returns[2000], { sp500:-0.3, nikkei:-0.35 });
Object.assign(returns[2008], { sp500:-0.4, nikkei:-0.45 });
Object.assign(returns[2020], { sp500:-0.25, nikkei:-0.3 });

const crashEvents = {
  1929:{title:"ä¸–ç•Œææ…Œ",detail:"ç±³å›½æ ªç´„90%ä¸‹è½ã€‚"},
  1973:{title:"ã‚ªã‚¤ãƒ«ã‚·ãƒ§ãƒƒã‚¯",detail:"ã‚¤ãƒ³ãƒ•ãƒ¬ã¨ä¸æ³ã€‚"},
  1987:{title:"ãƒ–ãƒ©ãƒƒã‚¯ãƒãƒ³ãƒ‡ãƒ¼",detail:"1æ—¥ã§-22%ã€‚"},
  2000:{title:"ITãƒãƒ–ãƒ«å´©å£Š",detail:"NASDAQç´„80%ä¸‹è½ã€‚"},
  2008:{title:"ãƒªãƒ¼ãƒãƒ³ã‚·ãƒ§ãƒƒã‚¯",detail:"ä¸–ç•Œé‡‘èå±æ©Ÿã€‚"},
  2020:{title:"ã‚³ãƒ­ãƒŠã‚·ãƒ§ãƒƒã‚¯",detail:"å²ä¸Šæœ€é€Ÿã®å›å¾©ã€‚"},
};

function run(){
  const s=+startYear.value,e=+endYear.value,m=mode.value;
  let labels=[],a=[],b=[],va=INITIAL_ASSET,vb=INITIAL_ASSET;
  for(let y=s;y<=e;y++){
    labels.push(y);
    if(m==="compare"){
      va*=1+returns[y].sp500; vb*=1+returns[y].nikkei;
      a.push(va); b.push(vb);
    } else {
      let r=asset.value==="cash"?0:returns[y][asset.value];
      va*=1+r; a.push(va);
    }
  }
  output.innerHTML=m==="compare"
    ? `<b>ç±³å›½æ ªï¼š</b>${Math.round(a.at(-1)).toLocaleString()}å††<br>
       <b>æ—¥æœ¬æ ªï¼š</b>${Math.round(b.at(-1)).toLocaleString()}å††`
    : `<b>æœ€çµ‚è³‡ç”£ï¼š</b>${Math.round(a.at(-1)).toLocaleString()}å††`;
  draw(labels,a,b,m); renderCrashInfo(s,e); renderLearningPoints(a,b,s,e,m);
}

function draw(labels,a,b,m){
  const c=chart,ctx=c.getContext("2d"); c.height=300;
  const p=40; ctx.clearRect(0,0,c.width,c.height);
  const all=m==="compare"?[...a,...b]:a, max=Math.max(...all), min=Math.min(...all);
  function line(d,color){
    ctx.beginPath();
    d.forEach((v,i)=>{
      const x=p+i/(d.length-1)*(c.width-p*2);
      const y=c.height-p-(v-min)/(max-min)*(c.height-p*2);
      i?ctx.lineTo(x,y):ctx.moveTo(x,y);
    });
    ctx.strokeStyle=color; ctx.stroke();
  }
  line(a,"blue"); if(m==="compare") line(b,"green");
  labels.forEach((y,i)=>{
    if(!crashEvents[y])return;
    const x=p+i/(labels.length-1)*(c.width-p*2);
    ctx.beginPath(); ctx.moveTo(x,p); ctx.lineTo(x,c.height-p);
    ctx.strokeStyle="rgba(255,0,0,.3)"; ctx.stroke();
  });
}

function renderCrashInfo(s,e){
  let h="<h3>ğŸ“‰ æŠ•è³‡æœŸé–“ä¸­ã®æš´è½</h3>",i=1;
  for(const y in crashEvents)
    if(y>=s&&y<=e) h+=`<p><b>${i++}. ${y}å¹´ ${crashEvents[y].title}</b><br>${crashEvents[y].detail}</p>`;
  crashInfo.innerHTML=i===1?"<p>å¤§ããªæš´è½ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>":h;
}

function renderLearningPoints(a,b,s,e,m){
  let p=[];
  if(e-s>=20)p.push("é•·æœŸã§ã¯æš´è½ã®å½±éŸ¿ã¯å°ã•ããªã‚Šã¾ã™ã€‚");
  if(m==="compare"&&a.at(-1)>b.at(-1))p.push("ç±³å›½æ ªã¯å›å¾©ãŒæ—©ã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚");
  p.push("éå»ã¯æœªæ¥ã‚’ä¿è¨¼ã—ã¾ã›ã‚“ã€‚");
  learningPoints.innerHTML="<h3>ğŸ“˜ å­¦ã³</h3><ul>"+p.map(x=>`<li>${x}</li>`).join("")+"</ul>";
}

function saveResultImage(){
  html2canvas(resultCard,{scale:2}).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL("image/png");
    a.download="investment_simulation.png";
    a.click();
  });
}

mode.onchange=()=>{
  asset.style.display=assetLabel.style.display=mode.value==="single"?"block":"none";
};
</script>
</body>
</html>
